# Epic 1.1: Angular Foundation

**Initiative**: [Initiative 1 - Sales + HR Management Web Application](../initiatives/01-sales-hr-web-application.md)
**Timeline**: Weeks 1-2
**Estimated Story Points**: 80-100
**Status**: Not Started

---

## Epic Overview

**As a development team, we want to establish a solid Angular v21 foundation with Nx workspace, authentication, routing, HTTP communication, and shared components, so that we can build feature modules efficiently with consistent patterns and best practices.**

---

## Epic Success Criteria (Gherkin Format)

**Given** the Angular foundation is complete
**When** developers begin building features
**Then** they should have:
- ✅ Nx workspace with Angular v21 configured
- ✅ Microsoft Entra ID authentication working
- ✅ Protected routes requiring authentication
- ✅ HTTP client with interceptors for JWT, correlation IDs, error handling
- ✅ Reusable shared component library styled with Tailwind CSS
- ✅ Consistent error handling and loading states across the app

---

## Features

### Feature 1.1.1: Nx Workspace Setup

**As a developer, I want an Nx workspace configured with Angular v21, so that I can build the application with modern tooling and monorepo capabilities.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create Nx Workspace**
- **Given** I have Node.js 20+ and npm installed
- **When** I run `npx create-nx-workspace@latest adventureworks-web`
- **Then** the workspace should be created with Angular preset
- **And** the workspace should use Nx 21+
- **And** the workspace should be configured for standalone components

**Scenario: Configure TypeScript**
- **Given** the Nx workspace exists
- **When** I configure TypeScript
- **Then** strict mode should be enabled
- **And** `noImplicitAny` should be true
- **And** `strictNullChecks` should be true

**Scenario: Build the Application**
- **Given** the Nx workspace is configured
- **When** I run `nx serve adventureworks-web`
- **Then** the dev server should start on http://localhost:4200
- **And** the default Angular welcome page should display

#### Technical Notes
- **Key Files**:
  - `apps/angular-web/nx.json` - Nx configuration
  - `apps/angular-web/tsconfig.json` - TypeScript configuration
  - `apps/angular-web/project.json` - Project-specific configuration
- **Dependencies**: `@nx/angular`, `@angular/cli`
- **Testing**: None required (scaffolding only)

#### Estimated Story Points: 5

---

### Feature 1.1.2: Tailwind CSS + DaisyUI Configuration

**As a developer, I want Tailwind CSS and DaisyUI configured, so that I can rapidly build UI components with utility classes and pre-built components.**

#### Acceptance Criteria (Gherkin)

**Scenario: Install Tailwind CSS**
- **Given** the Nx workspace exists
- **When** I install Tailwind CSS
- **Then** `tailwindcss`, `postcss`, and `autoprefixer` should be installed
- **And** `tailwind.config.js` should be created
- **And** `postcss.config.js` should be created

**Scenario: Install DaisyUI**
- **Given** Tailwind CSS is installed
- **When** I install DaisyUI
- **Then** `daisyui` should be installed as a Tailwind plugin
- **And** `tailwind.config.js` should include DaisyUI plugin
- **And** a theme should be configured (e.g., "corporate" or "business")

**Scenario: Verify Tailwind Styles**
- **Given** Tailwind and DaisyUI are configured
- **When** I add Tailwind classes to a component
- **Then** the styles should be applied correctly
- **And** DaisyUI component classes should work (e.g., `btn`, `card`, `badge`)

#### Technical Notes
- **Key Files**:
  - `apps/angular-web/tailwind.config.js` - Tailwind configuration
  - `apps/angular-web/src/styles.css` - Global styles with Tailwind directives
- **Dependencies**: `tailwindcss`, `postcss`, `autoprefixer`, `daisyui`
- **Testing**: Manual verification with test component

#### Estimated Story Points: 8

---

### Feature 1.1.3: Shared Component Library

**As a developer, I want a shared component library with reusable UI components, so that I can build consistent interfaces without duplicating code.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create Button Component**
- **Given** the shared library exists
- **When** I create a `Button` component
- **Then** the component should accept `type`, `variant`, `size`, and `disabled` inputs
- **And** the component should use DaisyUI button classes
- **And** the component should emit a `clicked` event

**Scenario: Create Input Component**
- **Given** the shared library exists
- **When** I create an `Input` component
- **Then** the component should support text, email, password, number types
- **And** the component should accept `label`, `placeholder`, `required`, `disabled` inputs
- **And** the component should integrate with Angular forms (ngModel/FormControl)
- **And** the component should display validation errors

**Scenario: Create Loading Spinner Component**
- **Given** the shared library exists
- **When** I create a `LoadingSpinner` component
- **Then** the component should accept `size` input (small, medium, large)
- **And** the component should use DaisyUI loading spinner class

**Scenario: Create Modal Component**
- **Given** the shared library exists
- **When** I create a `Modal` component
- **Then** the component should accept `title`, `open` inputs
- **And** the component should emit `close` event when backdrop clicked
- **And** the component should use DaisyUI modal classes

#### Technical Notes
- **Key Files**:
  - `libs/shared/ui/src/lib/button/button.component.ts`
  - `libs/shared/ui/src/lib/input/input.component.ts`
  - `libs/shared/ui/src/lib/loading-spinner/loading-spinner.component.ts`
  - `libs/shared/ui/src/lib/modal/modal.component.ts`
- **Dependencies**: `@angular/forms`
- **Testing**: Unit tests for each component

#### Estimated Story Points: 13

---

### Feature 1.1.4: Routing Configuration with Guards

**As a user, I want protected routes that require authentication, so that unauthorized users cannot access application features.**

#### Acceptance Criteria (Gherkin)

**Scenario: Configure Router**
- **Given** the Angular app is created
- **When** I configure routing
- **Then** the app should use Angular Router
- **And** routes should be defined for `/`, `/login`, `/dashboard`, `/sales`, `/hr`
- **And** protected routes should use `authGuard`

**Scenario: Create Auth Guard**
- **Given** the router is configured
- **When** I create an `authGuard`
- **Then** the guard should check if the user is authenticated
- **And** if authenticated, allow navigation
- **And** if not authenticated, redirect to `/login`

**Scenario: Navigate to Protected Route When Not Authenticated**
- **Given** the user is not authenticated
- **When** the user navigates to `/dashboard`
- **Then** the guard should prevent navigation
- **And** the user should be redirected to `/login`

**Scenario: Navigate to Protected Route When Authenticated**
- **Given** the user is authenticated
- **When** the user navigates to `/dashboard`
- **Then** the guard should allow navigation
- **And** the dashboard should load

#### Technical Notes
- **Key Files**:
  - `apps/angular-web/src/app/app.routes.ts` - Route definitions
  - `libs/shared/auth/src/lib/guards/auth.guard.ts` - Auth guard
- **Dependencies**: `@angular/router`
- **Testing**: Unit tests for auth guard

#### Estimated Story Points: 8

---

### Feature 1.1.5: Microsoft Entra ID Authentication Integration

**As a user, I want to sign in with my Microsoft account, so that I can access the application securely using single sign-on.**

#### Acceptance Criteria (Gherkin)

**Scenario: Configure MSAL**
- **Given** the Angular app exists
- **When** I configure MSAL (Microsoft Authentication Library)
- **Then** the app should be registered in Microsoft Entra ID
- **And** the client ID and tenant ID should be configured
- **And** redirect URIs should include `http://localhost:4200` and production URL

**Scenario: User Login Flow**
- **Given** the user is not authenticated
- **When** the user clicks "Sign In"
- **Then** the user should be redirected to Microsoft Entra ID login
- **And** after successful login, the user should be redirected back to the app
- **And** an access token should be stored

**Scenario: User Logout Flow**
- **Given** the user is authenticated
- **When** the user clicks "Sign Out"
- **Then** the access token should be cleared
- **And** the user should be redirected to the login page

**Scenario: Token Refresh**
- **Given** the user is authenticated
- **When** the access token expires
- **Then** MSAL should automatically refresh the token using the refresh token
- **And** the user should remain authenticated

#### Technical Notes
- **Key Files**:
  - `libs/shared/auth/src/lib/services/auth.service.ts` - Auth service wrapping MSAL
  - `apps/angular-web/src/app/app.config.ts` - MSAL configuration
- **Dependencies**: `@azure/msal-angular`, `@azure/msal-browser`
- **Environment**: Azure AD App Registration with redirect URIs configured
- **Testing**: Manual testing (E2E test for login flow)

#### Estimated Story Points: 13

---

### Feature 1.1.6: HTTP Client with Interceptors

**As a developer, I want HTTP interceptors that automatically add JWT tokens and correlation IDs to requests, so that API calls are authenticated and traceable.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create Auth Interceptor**
- **Given** the HTTP client is configured
- **When** I create an auth interceptor
- **Then** the interceptor should add the JWT token to the `Authorization` header
- **And** the token should be in the format `Bearer {token}`
- **And** if no token exists, the request should proceed without the header

**Scenario: Create Correlation ID Interceptor**
- **Given** the HTTP client is configured
- **When** I create a correlation ID interceptor
- **Then** the interceptor should generate a unique correlation ID (UUID)
- **And** the correlation ID should be added to the `X-Correlation-ID` header
- **And** the correlation ID should be logged for debugging

**Scenario: Create Error Interceptor**
- **Given** the HTTP client is configured
- **When** I create an error interceptor
- **Then** the interceptor should catch HTTP errors
- **And** for 401 errors, redirect to login
- **And** for 403 errors, show "Access Denied" message
- **And** for 500 errors, show "Server Error" message
- **And** for network errors, show "Network Error" message

**Scenario: Make API Request**
- **Given** all interceptors are configured
- **When** I make an HTTP request to the API
- **Then** the request should include the `Authorization` header
- **And** the request should include the `X-Correlation-ID` header
- **And** if the request fails, the error interceptor should handle it

#### Technical Notes
- **Key Files**:
  - `libs/shared/http/src/lib/interceptors/auth.interceptor.ts`
  - `libs/shared/http/src/lib/interceptors/correlation-id.interceptor.ts`
  - `libs/shared/http/src/lib/interceptors/error.interceptor.ts`
  - `apps/angular-web/src/app/app.config.ts` - HTTP interceptor registration
- **Dependencies**: `@angular/common/http`
- **Testing**: Unit tests for each interceptor

#### Estimated Story Points: 13

---

### Feature 1.1.7: API Service Layer

**As a developer, I want a type-safe API service layer, so that I can make HTTP requests with TypeScript interfaces matching backend DTOs.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create Base API Service**
- **Given** the HTTP client is configured
- **When** I create a base API service
- **Then** the service should provide `get`, `post`, `put`, `delete` methods
- **And** the methods should accept generic types for request/response
- **And** the service should handle the base URL from environment config

**Scenario: Create Sales API Service**
- **Given** the base API service exists
- **When** I create a Sales API service
- **Then** the service should extend the base API service
- **And** the service should provide methods for Stores and SalesPersons
- **And** the methods should use TypeScript interfaces matching backend DTOs

**Scenario: Make API Call**
- **Given** the Sales API service exists
- **When** I call `salesApi.getStores()`
- **Then** the request should be made to `/api/sales/stores`
- **And** the response should be typed as `Store[]`
- **And** the HTTP interceptors should add auth and correlation ID headers

#### Technical Notes
- **Key Files**:
  - `libs/shared/http/src/lib/services/base-api.service.ts`
  - `libs/sales/data-access/src/lib/services/sales-api.service.ts`
  - `libs/sales/data-access/src/lib/models/store.model.ts`
  - `libs/sales/data-access/src/lib/models/sales-person.model.ts`
- **Dependencies**: `@angular/common/http`
- **Testing**: Unit tests for API services with mock HTTP client

#### Estimated Story Points: 8

---

### Feature 1.1.8: Environment Configuration

**As a developer, I want environment-specific configuration, so that I can use different API URLs and settings for development and production.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create Development Environment**
- **Given** the Angular app exists
- **When** I create `environment.development.ts`
- **Then** the file should define `apiBaseUrl` as `http://localhost:5000`
- **And** the file should define `production` as `false`
- **And** the file should define Microsoft Entra ID config for local dev

**Scenario: Create Production Environment**
- **Given** the Angular app exists
- **When** I create `environment.production.ts`
- **Then** the file should define `apiBaseUrl` as Azure production URL
- **And** the file should define `production` as `true`
- **And** the file should define Microsoft Entra ID config for production

**Scenario: Use Environment Config**
- **Given** environment files are created
- **When** I import `environment` in a service
- **Then** the correct environment should be used based on build configuration
- **And** `ng serve` should use `environment.development.ts`
- **And** `ng build --configuration production` should use `environment.production.ts`

#### Technical Notes
- **Key Files**:
  - `apps/angular-web/src/environments/environment.development.ts`
  - `apps/angular-web/src/environments/environment.production.ts`
- **Dependencies**: None
- **Testing**: None required (configuration only)

#### Estimated Story Points: 5

---

### Feature 1.1.9: Global Error Handling and Loading States

**As a developer, I want global error handling and loading state management, so that users see consistent feedback for operations and errors.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create Global Loading Service**
- **Given** the app exists
- **When** I create a `LoadingService`
- **Then** the service should use Angular Signals for reactive state
- **And** the service should provide `show()` and `hide()` methods
- **And** the service should expose a `loading$` signal

**Scenario: Create Global Error Service**
- **Given** the app exists
- **When** I create an `ErrorService`
- **Then** the service should use Angular Signals for error state
- **And** the service should provide `showError(message: string)` method
- **And** the service should provide `clearError()` method
- **And** the service should expose an `error$` signal

**Scenario: Show Loading Spinner**
- **Given** the loading service exists
- **When** an HTTP request starts
- **Then** the loading spinner should be displayed
- **And** when the request completes, the spinner should hide
- **And** if multiple requests are in-flight, the spinner should remain until all complete

**Scenario: Show Error Message**
- **Given** the error service exists
- **When** an HTTP request fails
- **Then** an error message should be displayed to the user
- **And** the message should be user-friendly (not raw error)
- **And** the user should be able to dismiss the error

#### Technical Notes
- **Key Files**:
  - `libs/shared/ui/src/lib/services/loading.service.ts`
  - `libs/shared/ui/src/lib/services/error.service.ts`
  - `libs/shared/ui/src/lib/components/loading-overlay/loading-overlay.component.ts`
  - `libs/shared/ui/src/lib/components/error-toast/error-toast.component.ts`
- **Dependencies**: `@angular/core` (Signals)
- **Testing**: Unit tests for services

#### Estimated Story Points: 8

---

### Feature 1.1.10: App Shell with Navigation

**As a user, I want a consistent app shell with navigation, so that I can easily move between different sections of the application.**

#### Acceptance Criteria (Gherkin)

**Scenario: Create App Shell**
- **Given** the app exists
- **When** I create the app shell layout
- **Then** the shell should have a header with logo and user menu
- **And** the shell should have a sidebar with navigation links
- **And** the shell should have a main content area for router outlet
- **And** the shell should be responsive (collapsible sidebar on mobile)

**Scenario: Create Navigation Menu**
- **Given** the app shell exists
- **When** I create the navigation menu
- **Then** the menu should have links to Dashboard, Sales, HR
- **And** the active route should be highlighted
- **And** clicking a link should navigate to the route

**Scenario: Create User Menu**
- **Given** the app shell exists
- **When** I create the user menu
- **Then** the menu should display the user's name and avatar
- **And** the menu should have a "Sign Out" option
- **And** clicking "Sign Out" should log out the user

**Scenario: Responsive Behavior**
- **Given** the app shell exists
- **When** I resize the browser to mobile width
- **Then** the sidebar should collapse to a hamburger menu
- **And** clicking the hamburger should toggle the sidebar
- **And** on mobile, the sidebar should overlay the content

#### Technical Notes
- **Key Files**:
  - `apps/angular-web/src/app/app.component.ts` - App shell
  - `libs/shared/ui/src/lib/components/header/header.component.ts`
  - `libs/shared/ui/src/lib/components/sidebar/sidebar.component.ts`
- **Dependencies**: DaisyUI drawer component
- **Testing**: E2E test for navigation

#### Estimated Story Points: 13

---

## Epic Summary

### Total Estimated Story Points: 94

### Features Count: 10 Features

### Key Deliverables
- ✅ Nx workspace with Angular v21 and TypeScript configured
- ✅ Tailwind CSS + DaisyUI for rapid UI development
- ✅ Shared component library (Button, Input, Modal, LoadingSpinner)
- ✅ Routing with auth guards protecting routes
- ✅ Microsoft Entra ID authentication (login/logout/token refresh)
- ✅ HTTP interceptors (JWT auth, correlation IDs, error handling)
- ✅ Type-safe API service layer
- ✅ Environment configuration (dev/prod)
- ✅ Global error handling and loading states
- ✅ Responsive app shell with navigation

### Dependencies
- **External**: Microsoft Entra ID app registration
- **Tools**: Node.js 20+, npm, Angular CLI, Nx CLI
- **Backend**: API must have CORS configured for localhost:4200

### Risks
- **Microsoft Entra ID setup** may require trial and error
- **MSAL configuration** can be tricky for first-time users
- **Mitigation**: Follow Microsoft's official MSAL Angular tutorial

---

## Next Steps

1. **Complete Nx workspace setup** (Feature 1.1.1)
2. **Configure Tailwind + DaisyUI** (Feature 1.1.2)
3. **Build shared component library** (Feature 1.1.3)
4. **Set up routing and guards** (Feature 1.1.4)
5. **Integrate Microsoft Entra ID** (Feature 1.1.5)
6. **Add HTTP interceptors** (Feature 1.1.6)
7. **Create API service layer** (Feature 1.1.7)
8. **Configure environments** (Feature 1.1.8)
9. **Implement global error handling** (Feature 1.1.9)
10. **Build app shell with navigation** (Feature 1.1.10)

After completing this epic, proceed to [Epic 1.2: Sales CRUD UI](1.2-sales-crud-ui.md).

---

**Document Version**: 1.0
**Last Updated**: 2026-01-17
**Status**: Ready for Implementation
