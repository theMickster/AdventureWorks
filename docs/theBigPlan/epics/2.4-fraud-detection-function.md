# Epic 2.4: Real-Time Fraud Detection Function

**Initiative**: [Initiative 2 - Event-Driven Microservices + Production Infrastructure](../initiatives/02-event-driven-microservices-infrastructure.md)
**Timeline**: Week 13
**Estimated Story Points**: 80-100
**Status**: Not Started

---

## Epic Overview

**As a security analyst, I want suspicious transactions flagged in real-time, so that fraud is prevented before financial loss.**

---

## Epic Success Criteria (Gherkin Format)

**Given** an order is created
**When** the Fraud Detection Function processes it
**Then**:
- ✅ Event Grid receives OrderCreated event
- ✅ Durable Function orchestrates validation workflow
- ✅ Go (or Node.js) function performs high-speed rule checks
- ✅ If flagged: Teams/Slack webhook notification sent
- ✅ Results stored with correlation ID for audit

---

## Features

### Feature 2.4.1: Event Grid Setup
**As a developer, I want Event Grid configured for OrderCreated events.**

**Acceptance Criteria**: Event Grid topic created, subscription configured, schema validation.
**Estimated Story Points**: 8

---

### Feature 2.4.2: Durable Function Orchestration
**As a developer, I want Durable Function orchestrating fraud detection.**

**Acceptance Criteria**: Orchestrator function calls activity functions, handles timeouts, logs correlation IDs.
**Key Files**: `apps/microservices/fraud-detection/FraudDetectionOrchestrator.cs`
**Estimated Story Points**: 13

---

### Feature 2.4.3: Go Function for Rule Checks
**As a developer, I want a Go function for high-speed rule validation.**

**Acceptance Criteria**: Go custom handler, rule engine checks (amount thresholds, velocity checks), returns risk score.
**Key Files**: `apps/microservices/fraud-detection-go/main.go`
**Alternative**: Node.js if Go proves challenging
**Estimated Story Points**: 20

---

### Feature 2.4.4: Teams/Slack Webhook Integration
**As a developer, I want webhook notifications for flagged transactions.**

**Acceptance Criteria**: Send webhook to Teams/Slack, formatted message with transaction details, error handling.
**Estimated Story Points**: 8

---

### Feature 2.4.5: Audit Logging
**As a developer, I want all results logged for audit.**

**Acceptance Criteria**: Store results in Table Storage or Cosmos DB, include correlation ID, timestamp, risk score, decision.
**Estimated Story Points**: 8

---

### Feature 2.4.6: Unit Tests for Orchestrator
**As a developer, I want unit tests for Durable Function.**

**Acceptance Criteria**: Tests for: orchestration logic, activity function calls, error handling.
**Estimated Story Points**: 13

---

### Feature 2.4.7: Integration Test for Event Flow
**As a developer, I want integration test for full event flow.**

**Acceptance Criteria**: Publish OrderCreated event, verify function triggered, verify webhook sent (mocked).
**Estimated Story Points**: 13

---

## Epic Summary

### Total Estimated Story Points: 83

### Key Deliverables
- ✅ Event Grid configured
- ✅ Durable Function orchestration
- ✅ Go (or Node.js) function for rules
- ✅ Teams/Slack webhook integration
- ✅ Audit logging
- ✅ Test coverage

---

**Document Version**: 1.0
**Last Updated**: 2026-01-17
**Status**: Ready for Implementation
