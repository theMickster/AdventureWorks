<!-- Skip to content (WCAG AA) -->
<a
  id="aw-skip-link"
  class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:rounded focus:bg-base-100 focus:p-4 focus:text-primary focus:underline focus:shadow-lg"
  href="#main-content"
>
  Skip to main content
</a>

<div id="aw-shell" class="drawer lg:drawer-open">
  <input id="aw-drawer" type="checkbox" class="drawer-toggle" aria-label="Sidebar toggle" />

  <!-- Main content area -->
  <div id="aw-drawer-content" class="drawer-content flex flex-col bg-base-100 h-screen">
    <!-- Global loading bar -->
    @if (loadingService.isLoading()) {
      <div id="aw-loading-bar" class="fixed top-0 left-0 right-0 z-50 h-1 overflow-hidden bg-primary/20">
        <div class="h-full w-1/3 animate-[loading-slide_1.5s_ease-in-out_infinite] bg-primary"></div>
      </div>
    }

    <!-- Top navbar -->
    <header id="aw-header" role="banner">
      <nav id="aw-navbar" class="navbar bg-base-100 shadow-sm sticky top-0 z-30" aria-label="Global">
        <!-- Hamburger (mobile only) -->
        <div id="aw-navbar-start" class="flex-none lg:hidden">
          <label id="aw-sidebar-open" for="aw-drawer" aria-label="Open sidebar" class="btn btn-square btn-ghost">
            <i class="fa-solid fa-bars text-lg" aria-hidden="true"></i>
          </label>
        </div>

        <!-- Breadcrumbs -->
        <div id="aw-navbar-center" class="flex-1 px-4">
          <nav id="aw-breadcrumb-nav" aria-label="Breadcrumb">
            <div id="aw-breadcrumbs" class="breadcrumbs text-sm">
              <ul>
                <li>
                  <a routerLink="/dashboard">
                    <i class="fa-solid fa-house" aria-hidden="true"></i>
                    Home
                  </a>
                </li>
                @for (crumb of breadcrumbs(); track crumb.url) {
                  @if ($last) {
                    <li aria-current="page">{{ crumb.label }}</li>
                  } @else {
                    <li>
                      <a [routerLink]="crumb.url">{{ crumb.label }}</a>
                    </li>
                  }
                }
              </ul>
            </div>
          </nav>
        </div>

        <!-- Theme toggle + user menu -->
        <div id="aw-navbar-end" class="flex-none flex items-center gap-1">
          <!-- Theme toggle -->
          <button id="aw-theme-toggle" (click)="themeService.toggle()" class="btn btn-ghost btn-circle">
            @if (themeService.darkMode()) {
              <i class="fa-solid fa-sun text-lg" aria-hidden="true"></i>
              <span class="sr-only">Switch to light theme</span>
            } @else {
              <i class="fa-solid fa-moon text-lg" aria-hidden="true"></i>
              <span class="sr-only">Switch to dark theme</span>
            }
          </button>

          <!-- User avatar dropdown -->
          <div id="aw-user-menu" class="dropdown dropdown-end">
            <button
              id="aw-user-menu-trigger"
              #userMenuTrigger
              class="btn btn-ghost btn-circle"
              aria-haspopup="true"
              [attr.aria-expanded]="userMenuOpen()"
              aria-controls="aw-user-menu-dropdown"
              (click)="userMenuOpen.set(!userMenuOpen())"
              (keydown.escape)="closeUserMenu()"
            >
              <div class="avatar placeholder">
                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-neutral text-neutral-content">
                  <span class="text-xs font-semibold">AW</span>
                </div>
              </div>
              <span class="sr-only">User menu</span>
            </button>
            <ul
              id="aw-user-menu-dropdown"
              tabindex="-1"
              class="menu menu-sm dropdown-content bg-base-100 rounded-box z-50 mt-3 w-52 p-2 shadow-lg"
            >
              <li class="menu-title">Admin User</li>
              <li id="aw-user-menu-profile">
                <button (keydown.escape)="closeUserMenu()">
                  <i class="fa-solid fa-user" aria-hidden="true"></i> Profile
                </button>
              </li>
              <li id="aw-user-menu-settings">
                <button (keydown.escape)="closeUserMenu()">
                  <i class="fa-solid fa-gear" aria-hidden="true"></i> Settings
                </button>
              </li>
              <li id="aw-user-menu-signout" class="border-t border-base-300 mt-1 pt-1">
                <button class="text-error" (keydown.escape)="closeUserMenu()">
                  <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i> Sign Out
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Page content -->
    <main id="main-content" role="main" class="flex-1 overflow-y-auto p-6">
      <router-outlet />
    </main>

    <!-- Footer -->
    <footer id="aw-footer" class="border-t border-base-300 px-6 py-3 text-center text-xs text-base-content/50">
      &copy; 2005&ndash;{{ currentYear }} AdventureWorks Cycling. All rights reserved.
    </footer>

    <!-- Toast notifications -->
    <aw-toast-container />
  </div>

  <!-- Sidebar -->
  <div id="aw-drawer-side" class="drawer-side z-40">
    <label id="aw-sidebar-close" for="aw-drawer" aria-label="Close sidebar" class="drawer-overlay"></label>

    <nav id="aw-sidebar" aria-label="Primary" role="navigation" class="bg-base-200 min-h-full w-72 flex flex-col">
      <!-- Logo (h-16 + border-b aligns with navbar height + shadow) -->
      <div id="aw-sidebar-brand" class="flex h-16 items-center gap-3 border-b border-base-300 px-4">
        <img ngSrc="logos/aw-icon-transparent.png" alt="AdventureWorks" width="415" height="301" class="h-10 w-auto" />
        <div>
          <h2 class="text-lg font-bold text-base-content leading-tight">AdventureWorks</h2>
          <p class="text-xs text-base-content/60">Cycling</p>
        </div>
      </div>

      <!-- Navigation menu -->
      <ul id="aw-sidebar-nav" class="menu menu-md w-full flex-1 px-2 py-4">
        <!-- Dashboard -->
        <li id="aw-nav-dashboard">
          <a routerLink="/dashboard" routerLinkActive="menu-active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fa-solid fa-gauge-high" aria-hidden="true"></i>
            Dashboard
          </a>
        </li>

        <!-- Sales (collapsible) -->
        <li id="aw-nav-sales" #salesNav>
          <details>
            <summary>
              <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i>
              Sales
            </summary>
            <ul>
              <li id="aw-nav-sales-stores">
                <a
                  routerLink="/sales/stores"
                  routerLinkActive="menu-active"
                  [routerLinkActiveOptions]="{ exact: true }"
                >
                  Stores
                </a>
              </li>
              <li id="aw-nav-sales-persons">
                <a
                  routerLink="/sales/persons"
                  routerLinkActive="menu-active"
                  [routerLinkActiveOptions]="{ exact: true }"
                >
                  Sales Persons
                </a>
              </li>
            </ul>
          </details>
        </li>

        <!-- Human Resources (collapsible) -->
        <li id="aw-nav-hr" #hrNav>
          <details>
            <summary>
              <i class="fa-solid fa-users" aria-hidden="true"></i>
              Human Resources
            </summary>
            <ul>
              <li id="aw-nav-hr-employees">
                <a
                  routerLink="/hr/employees"
                  routerLinkActive="menu-active"
                  [routerLinkActiveOptions]="{ exact: true }"
                >
                  Employees
                </a>
              </li>
              <li id="aw-nav-hr-departments">
                <a
                  routerLink="/hr/departments"
                  routerLinkActive="menu-active"
                  [routerLinkActiveOptions]="{ exact: true }"
                >
                  Departments
                </a>
              </li>
            </ul>
          </details>
        </li>

        <!-- Section divider -->
        <li class="menu-title mt-4">System</li>

        <!-- Samples (design system showcase) -->
        <li id="aw-nav-samples">
          <a routerLink="/samples" routerLinkActive="menu-active" [routerLinkActiveOptions]="{ exact: true }">
            <i class="fa-solid fa-palette" aria-hidden="true"></i>
            Samples
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
